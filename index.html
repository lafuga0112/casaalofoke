<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Puntuaciones - Alofoke Reality Show</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="images/fav.jpg" type="image/jpeg">
    <meta name="description" content="Tabla de Puntuaciones - Alofoke Reality Show">
    <meta name="keywords" content="Alofoke, Reality Show, Puntuaciones, Tabla de Puntuaciones">
    <meta name="author" content="Alofoke">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="google" content="notranslate">
    <meta name="google-site-verification" content="google-site-verification=google-site-verification">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2567586545384813"
     crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">

</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2650HKVSYV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2650HKVSYV');
</script>
<body>
    <!-- Header Principal -->
    <header class="header">
        <div class="header-content">

            <div class="social-header">
                <div class="social-message">
                    <span class="social-message-text">Disfruta del Reality en los canales oficiales</span>
                </div>
                <div class="social-links">
                    <a href="https://www.instagram.com/casaalofoke/" target="_blank" class="social-header-link instagram">
                        <img src="images/ig.png" alt="Instagram" class="social-header-icon">
                        <span class="social-header-text">@casaalofoke</span>
                    </a>
                    <a href="https://www.youtube.com/watch?app=desktop&v=gOJvu0xYsdo&fbclid=PAZXh0bgNhZW0CMTEAAaeucH45DPPbuwn5_nzesxOrArvYTOJWZbaATMYH-nwcS3XmuLiTHjP4lZ8EFg_aem_fzVrWP8OPCdZxhL7yXspLg" target="_blank" class="social-header-link youtube">
                        <img src="images/yt.png" alt="YouTube" class="social-header-icon">
                        <span class="social-header-text">Alofoke Radio Show</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor Principal -->
    <main class="main-container">
        <!-- Switch de Vista -->
        <section class="view-switch">
            <div class="switch-container">
                <span class="switch-label">Puntuaciones</span>
                <label class="switch">
                    <input type="checkbox" id="view-toggle">
                    <span class="slider"></span>
                </label>
                <span class="switch-label">SuperChats En Vivo</span>
            </div>
        </section>

        <!-- Vista Solo Puntuaciones -->
        <section class="contestants-panel" id="puntuaciones-view">
            <div class="contestants-grid">
                <!-- LA GIGI -->
                <div class="contestant-card" style="--card-index: 0;">
                    <div class="contestant-name">LA GIGI</div>
                    <div class="contestant-photo">
                        <img src="images/gigi.jpg" alt="LA GIGI" class="profile-img" onclick="openContestantProfile('gigi')">
                    </div>
                    <div class="contestant-score" id="score-gigi">0PTS</div>
                </div>

                <!-- GIUSEPPE/TRUJILLO -->
                <div class="contestant-card" style="--card-index: 1;">
                    <div class="contestant-name">GIUSEPPE</div>
                    <div class="contestant-photo">
                        <img src="images/GIUSEPPE.jpg" alt="GIUSEPPE" class="profile-img" onclick="openContestantProfile('giuseppe')">
                    </div>
                    <div class="contestant-score" id="score-giuseppe">0PTS</div>
                </div>

                <!-- VLADY -->
                <div class="contestant-card" style="--card-index: 2;">
                    <div class="contestant-name">VLADY</div>
                    <div class="contestant-photo">
                        <img src="images/vlady.jpg" alt="VLADY" class="profile-img" onclick="openContestantProfile('vlady')">
                    </div>
                    <div class="contestant-score" id="score-vlady">0PTS</div>
                </div>

                <!-- CRAZY -->
                <div class="contestant-card" style="--card-index: 3;">
                    <div class="contestant-name">CRAZY</div>
                    <div class="contestant-photo">
                        <img src="images/CRAZY.jpg" alt="CRAZY" class="profile-img" onclick="openContestantProfile('crazy')">
                    </div>
                    <div class="contestant-score" id="score-crazy">0PTS</div>
                </div>

                <!-- Pamela -->
                <div class="contestant-card eliminated" style="--card-index: 4;">
                    <div class="contestant-name">PAMELA</div>
                    <div class="contestant-photo">
                        <img src="images/pamela.jpg" alt="PAMELA" class="profile-img" onclick="openContestantProfile('pamela')">
                    </div>
                    <div class="contestant-score" id="score-pamela">ELIMINADO</div>
                </div>

                <!-- KAROLA -->
                <div class="contestant-card" style="--card-index: 5;">
                    <div class="contestant-name">KAROLA</div>
                    <div class="contestant-photo">
                        <img src="images/karola.jpg" alt="KAROLA" class="profile-img" onclick="openContestantProfile('karola')">
                    </div>
                    <div class="contestant-score" id="score-karola">0PTS</div>
                </div>

                <!-- JIMENEZ -->
                <div class="contestant-card eliminated" style="--card-index: 6;">
                    <div class="contestant-name">JIMENEZ</div>
                    <div class="contestant-photo">
                        <img src="images/JIMENEZ.jpg" alt="JIMENEZ" class="profile-img" onclick="openContestantProfile('jimenez')">
                    </div>
                    <div class="contestant-score" id="score-jimenez">ELIMINADO</div>
                </div>

                <!-- LA PEKI -->
                <div class="contestant-card eliminated" style="--card-index: 7;">
                    <div class="contestant-name">LA PEKI</div>
                    <div class="contestant-photo">
                        <img src="images/peki.jpg" alt="LA PEKI" class="profile-img" onclick="openContestantProfile('peki')">
                    </div>
                    <div class="contestant-score" id="score-peky">ELIMINADO</div>
                </div>

                <!-- CRUSITA -->
                <div class="contestant-card" style="--card-index: 8;">
                    <div class="contestant-name">CRUSITA</div>
                    <div class="contestant-photo">
                        <img src="images/CRUSITA.jpg" alt="CRUSITA" class="profile-img" onclick="openContestantProfile('crusita')">
                    </div>
                    <div class="contestant-score" id="score-crusita">0PTS</div>
                </div>

                <!-- LUISE -->
                <div class="contestant-card" style="--card-index: 9;">
                    <div class="contestant-name">LUISE</div>
                    <div class="contestant-photo">
                        <img src="images/luise.jpg" alt="LUISE" class="profile-img" onclick="openContestantProfile('luise')">
                    </div>
                    <div class="contestant-score" id="score-luise">0PTS</div>
                </div>

                <!-- CARLOS -->
                <div class="contestant-card" style="--card-index: 10;">
                    <div class="contestant-name">CARLOS</div>
                    <div class="contestant-photo">
                        <img src="images/carlos.png" alt="CARLOS" class="profile-img" onclick="openContestantProfile('carlos')">
                    </div>
                    <div class="contestant-score" id="score-carlos">0PTS</div>
                </div>
            </div>
            
            <!-- Leyenda del Sistema de Puntuaci√≥n -->
            <div class="scoring-legend">
                <div class="legend-header">
                    <h3>INFORMACI√ìN DEL SISTEMA DE PUNTUACI√ìN</h3>
                </div>
                <div class="legend-content">
                    <div class="legend-item">
                        <span class="legend-label">Contabilizaci√≥n desde:</span>
                        <span class="legend-value">20 de Agosto, 2025 - 11:53 AM</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-label">√öltima actualizaci√≥n:</span>
                        <span class="legend-value" id="last-update">--:-- --</span>
                    </div>
                </div>
                
                <!-- Informaci√≥n sobre distribuci√≥n de puntos -->
                <div class="legend-content distribution-info">
                    <div class="legend-item">
                        <span class="legend-label">¬øC√≥mo se reparten los puntos?</span>
                        <span class="legend-value">
                            Cuando un SuperChat menciona a varios concursantes en un mismo mensaje, los puntos se dividen equitativamente entre ellos.
                            Por ejemplo, si un SuperChat de $10 menciona a GIGI y VLADY, cada uno recibe 5 puntos.
                        </span>
                    </div>
                </div>
                
                <!-- Disclaimer Legal -->
                <div class="disclaimer">
                    <div class="disclaimer-content">
                        <span class="disclaimer-text">
                            <strong>IMPORTANTE:</strong> Este sistema de puntuaci√≥n NO es un conteo oficial de parte de la empresa Alofoke. 
                            Fue creado por un fan como herramienta informativa y de entretenimiento. 
                            Los resultados pueden no reflejar la puntuaci√≥n real del reality show.
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista Combinada: SuperChats (Izquierda) + Tabla Lista (Derecha) -->
        <section class="live-view" id="superchats-view" style="display: none;">
            <!-- Panel de SuperChats (Izquierda) -->
            <div class="superchats-panel">
                <div class="superchats-header">
                    <div class="superchats-title">
                        <h2>SUPERCHATS EN VIVO</h2>
                    </div>
                    
                    <!-- Indicador de estado del monitor -->
                    <div class="monitor-status" id="monitor-status">
                        <div class="status-indicator">
                            <span class="status-dot" id="status-dot">üî¥</span>
                            <span class="status-text" id="status-text">INICIANDO...</span>
                        </div>
                        <div class="status-details">
                            <span class="status-detail" id="last-superchat">√öltimo: --</span>
                            <span class="status-separator">|</span>
                            <span class="status-detail" id="total-superchats">Total: 0</span>
                            <span class="status-separator">|</span>
                            <span class="status-detail" id="connection-status">Desconectado</span>
                        </div>
                    </div>
                </div>
                
                <div class="superchats-container">
                    <!-- Notificaci√≥n de nuevos SuperChats -->
                    <div class="new-chats-notification" id="new-chats-notification" style="display: none;">
                        <span class="new-chats-text" id="new-chats-text">Nuevos SuperChats disponibles</span>
                        <button class="new-chats-button" id="new-chats-button">Ver nuevos</button>
                    </div>
                    
                    <div class="superchats-list" id="superchats-list">
                        <!-- Los SuperChats se mostrar√°n aqu√≠ -->
                        <div class="no-superchats">
                            <div class="no-superchats-text">Esperando SuperChats...</div>
                            <div class="no-superchats-subtext">Los SuperChats aparecer√°n aqu√≠ en tiempo real</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabla de Posiciones en Lista (Derecha) -->
            <div class="positions-list-panel">
                <div class="positions-header">
                    <h2>TABLA DE POSICIONES</h2>
                    <div class="positions-subtitle">Actualizada en tiempo real</div>
                </div>
                <div class="positions-list">
                    <!-- LA GIGI -->
                    <div class="position-item" data-contestant="gigi">
                        <div class="position-rank">1</div>
                        <div class="position-avatar">
                            <img src="images/gigi.jpg" alt="LA GIGI" class="position-img" onclick="openContestantProfile('gigi')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LA GIGI</div>
                            <div class="position-score" id="list-score-gigi">0 PTS</div>
                        </div>
                    </div>

                    <!-- GIUSEPPE -->
                    <div class="position-item" data-contestant="giuseppe">
                        <div class="position-rank">2</div>
                        <div class="position-avatar">
                            <img src="images/GIUSEPPE.jpg" alt="GIUSEPPE" class="position-img" onclick="openContestantProfile('giuseppe')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">GIUSEPPE</div>
                            <div class="position-score" id="list-score-giuseppe">0 PTS</div>
                        </div>
                    </div>

                    <!-- VLADY -->
                    <div class="position-item" data-contestant="vlady">
                        <div class="position-rank">3</div>
                        <div class="position-avatar">
                            <img src="images/vlady.jpg" alt="VLADY" class="position-img" onclick="openContestantProfile('vlady')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">VLADY</div>
                            <div class="position-score" id="list-score-vlady">0 PTS</div>
                        </div>
                    </div>

                    <!-- CRAZY -->
                    <div class="position-item" data-contestant="crazy">
                        <div class="position-rank">4</div>
                        <div class="position-avatar">
                            <img src="images/CRAZY.jpg" alt="CRAZY" class="position-img" onclick="openContestantProfile('crazy')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">CRAZY</div>
                            <div class="position-score" id="list-score-crazy">0 PTS</div>
                        </div>
                    </div>

                    <!-- KAROLA -->
                    <div class="position-item" data-contestant="karola">
                        <div class="position-rank">5</div>
                        <div class="position-avatar">
                            <img src="images/karola.jpg" alt="KAROLA" class="position-img" onclick="openContestantProfile('karola')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">KAROLA</div>
                            <div class="position-score" id="list-score-karola">0 PTS</div>
                        </div>
                    </div>

                    <!-- CRUSITA -->
                    <div class="position-item" data-contestant="crusita">
                        <div class="position-rank">6</div>
                        <div class="position-avatar">
                            <img src="images/CRUSITA.jpg" alt="CRUSITA" class="position-img" onclick="openContestantProfile('crusita')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">CRUSITA</div>
                            <div class="position-score" id="list-score-crusita">0 PTS</div>
                        </div>
                    </div>

                    <!-- LUISE -->
                    <div class="position-item" data-contestant="luise">
                        <div class="position-rank">7</div>
                        <div class="position-avatar">
                            <img src="images/luise.jpg" alt="LUISE" class="position-img" onclick="openContestantProfile('luise')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LUISE</div>
                            <div class="position-score" id="list-score-luise">0 PTS</div>
                        </div>
                    </div>

                    <!-- CARLOS -->
                    <div class="position-item" data-contestant="carlos">
                        <div class="position-rank">8</div>
                        <div class="position-avatar">
                            <img src="images/carlos.png" alt="CARLOS" class="position-img" onclick="openContestantProfile('carlos')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">CARLOS</div>
                            <div class="position-score" id="list-score-carlos">0 PTS</div>
                        </div>
                    </div>

                    <!-- PARTICIPANTES ELIMINADOS AL FINAL -->
                    
                    <!-- PAMELA -->
                    <div class="position-item eliminated" data-contestant="pamela">
                        <div class="position-rank">X</div>
                        <div class="position-avatar">
                            <img src="images/pamela.jpg" alt="PAMELA" class="position-img" onclick="openContestantProfile('pamela')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">PAMELA</div>
                            <div class="position-score" id="list-score-pamela">ELIMINADO</div>
                        </div>
                    </div>

                    <!-- JIMENEZ -->
                    <div class="position-item eliminated" data-contestant="jimenez">
                        <div class="position-rank">X</div>
                        <div class="position-avatar">
                            <img src="images/JIMENEZ.jpg" alt="JIMENEZ" class="position-img" onclick="openContestantProfile('jimenez')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">JIMENEZ</div>
                            <div class="position-score" id="list-score-jimenez">ELIMINADO</div>
                        </div>
                    </div>

                    <!-- LA PEKI -->
                    <div class="position-item eliminated" data-contestant="peky">
                        <div class="position-rank">X</div>
                        <div class="position-avatar">
                            <img src="images/peki.jpg" alt="LA PEKI" class="position-img" onclick="openContestantProfile('peky')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LA PEKI</div>
                            <div class="position-score" id="list-score-peky">ELIMINADO</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span class="powered-by">Powered By</span>
            <span class="creator-name">MrFugaRD</span>
        </div>
    </footer>

    <!-- Modal de Historial de SuperChats -->
    <div class="contestant-history-modal" id="history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Historial de SuperChats - <span id="modal-contestant-name">GIGI</span></h3>
                <button class="modal-close" onclick="closeHistoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="history-list" id="history-list">
                    <!-- Los SuperChats se renderizan aqu√≠ -->
                </div>
                <div class="modal-footer">
                    <button class="instagram-btn" onclick="openInstagram()">Ver Instagram</button>
                    <button class="load-more-btn" id="load-more-btn" onclick="loadMoreHistory()" style="display: none;">Cargar m√°s</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Script para actualizar puntuaciones en tiempo real -->
    <script>
        // Conexi√≥n WebSocket
        const socket = io({
            transports: ['websocket', 'polling'],
            path: '/socket.io',
            reconnection: true,
            reconnectionAttempts: 10,
            reconnectionDelay: 5000,
            reconnectionDelayMax: 60000,
            timeout: 60000
        });
        
        // Variables globales
        let isConnected = false;
        let autoScroll = true;
        let totalSuperChats = 0;
        let totalAmount = 0;
        let previousPositions = {}; // Para rastrear posiciones anteriores
        
        // Variables para scroll inteligente
        let userIsReading = false; // Si el usuario est√° leyendo SuperChats antiguos
        let pendingNewChats = 0; // Cantidad de SuperChats nuevos pendientes
        
        // Variables para indicador de estado
        let lastSuperChatTime = null; // Timestamp del √∫ltimo SuperChat
        let monitorActive = false; // Si el monitor est√° activo
        let sessionSuperChats = 0; // SuperChats de esta sesi√≥n
        
        // Funci√≥n para manejar el switch de vista
        function initViewSwitch() {
            const viewToggle = document.getElementById('view-toggle');
            const puntuacionesView = document.getElementById('puntuaciones-view');
            const superchatsView = document.getElementById('superchats-view');
            const switchLabels = document.querySelectorAll('.switch-label');
            
            // Funci√≥n para detectar si estamos en m√≥vil
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // Funci√≥n para mostrar/ocultar vistas correctamente
            function updateViews(showSuperChats) {
                if (showSuperChats) {
                    // Mostrar vista SuperChats
                    puntuacionesView.style.display = 'none';
                    
                    // Usar el display apropiado seg√∫n el tama√±o de pantalla
                    if (isMobile()) {
                        superchatsView.style.display = 'flex';
                    } else {
                        superchatsView.style.display = 'grid';
                    }
                    
                    // Actualizar labels
                    switchLabels[0].classList.remove('active');
                    switchLabels[1].classList.add('active');
                } else {
                    // Mostrar vista Puntuaciones SOLAMENTE
                    puntuacionesView.style.display = 'block';
                    superchatsView.style.display = 'none';
                    
                    // Actualizar labels
                    switchLabels[0].classList.add('active');
                    switchLabels[1].classList.remove('active');
                }
            }
            
            viewToggle.addEventListener('change', () => {
                updateViews(viewToggle.checked);
            });
            
            // Manejar cambios de tama√±o de ventana
            window.addEventListener('resize', () => {
                if (viewToggle.checked) {
                    // Si estamos en vista SuperChats, actualizar el display
                    if (isMobile()) {
                        superchatsView.style.display = 'flex';
                    } else {
                        superchatsView.style.display = 'grid';
                    }
                }
            });
            
            // Inicializar estado - SOLO puntuaciones visible
            switchLabels[0].classList.add('active');
            puntuacionesView.style.display = 'block';
            superchatsView.style.display = 'none';
        }
        
        // Controles de SuperChats con scroll inteligente
        function initSuperChatControls() {
            // Auto scroll siempre activado autom√°ticamente
            autoScroll = true;
            
            // Event listener para detectar scroll manual del usuario
            const superChatsList = document.getElementById('superchats-list');
            
            superChatsList.addEventListener('scroll', function() {
                // Si el usuario hace scroll manualmente, detectar si est√° al final
                if (isUserAtBottom()) {
                    // Si vuelve al final, ya no est√° leyendo
                    userIsReading = false;
                    pendingNewChats = 0;
                    updateNewChatsNotification();
                } else {
                    // Si no est√° al final, est√° leyendo SuperChats antiguos
                    userIsReading = true;
                }
            });
        }
        
        // Funci√≥n para limpiar SuperChats
        function clearSuperChats() {
            const superChatsList = document.getElementById('superchats-list');
            superChatsList.innerHTML = `
                <div class="no-superchats">
                    <div class="no-superchats-text">Chat Limpiado</div>
                    <div class="no-superchats-subtext">Los nuevos SuperChats aparecer√°n aqu√≠</div>
                </div>
            `;
            
            // Resetear estad√≠sticas y scroll inteligente
            totalSuperChats = 0;
            totalAmount = 0;
            pendingNewChats = 0;
            userIsReading = false;
            updateSuperChatStats();
            updateNewChatsNotification();
        }
        
        // Funci√≥n para hacer scroll al final
        function scrollToBottom() {
            const superChatsList = document.getElementById('superchats-list');
            superChatsList.scrollTop = superChatsList.scrollHeight;
            userIsReading = false; // Al hacer scroll manual, ya no est√° leyendo
        }

        // Funci√≥n para detectar si el usuario est√° al final de la lista
        function isUserAtBottom() {
            const superChatsList = document.getElementById('superchats-list');
            const threshold = 50; // 50px de margen
            return (superChatsList.scrollTop + superChatsList.clientHeight) >= (superChatsList.scrollHeight - threshold);
        }

        // Funci√≥n para mostrar/ocultar notificaci√≥n de nuevos SuperChats
        function updateNewChatsNotification() {
            const notification = document.getElementById('new-chats-notification');
            const text = document.getElementById('new-chats-text');
            
            if (pendingNewChats > 0 && userIsReading) {
                notification.style.display = 'flex';
                text.textContent = `${pendingNewChats} nuevo${pendingNewChats > 1 ? 's' : ''} SuperChat${pendingNewChats > 1 ? 's' : ''}`;
            } else {
                notification.style.display = 'none';
                pendingNewChats = 0;
            }
        }

        // Funci√≥n para ir a los nuevos SuperChats
        function goToNewChats() {
            scrollToBottom();
            pendingNewChats = 0;
            updateNewChatsNotification();
        }

        // Funci√≥n para formatear tiempo transcurrido
        function formatTimeAgo(timestamp) {
            if (!timestamp) return '--';
            
            const now = new Date();
            const then = new Date(timestamp);
            const diffMs = now - then;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            
            if (diffSeconds < 60) {
                return `hace ${diffSeconds}s`;
            } else if (diffMinutes < 60) {
                return `hace ${diffMinutes}m`;
            } else if (diffHours < 24) {
                return `hace ${diffHours}h`;
            } else {
                return `hace ${Math.floor(diffHours / 24)}d`;
            }
        }

        // Funci√≥n para actualizar el indicador de estado
        function updateMonitorStatus() {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const lastSuperChatEl = document.getElementById('last-superchat');
            const totalSuperChatsEl = document.getElementById('total-superchats');
            const connectionStatusEl = document.getElementById('connection-status');
            
            // Estado del monitor
            if (monitorActive && isConnected) {
                statusDot.textContent = 'üü¢';
                statusText.textContent = 'MONITOR ACTIVO';
            } else if (isConnected) {
                statusDot.textContent = 'üü°';
                statusText.textContent = 'CONECTADO';
            } else {
                statusDot.textContent = 'üî¥';
                statusText.textContent = 'DESCONECTADO';
            }
            
            // √öltimo SuperChat
            lastSuperChatEl.textContent = `√öltimo: ${formatTimeAgo(lastSuperChatTime)}`;
            
            // Total de SuperChats
            totalSuperChatsEl.textContent = `Total: ${sessionSuperChats}`;
            
            // Estado de conexi√≥n
            connectionStatusEl.textContent = isConnected ? 'üîó Conectado' : 'üîó Desconectado';
        }

        // Funci√≥n para actualizar el estado cada segundo
        function startStatusUpdater() {
            setInterval(updateMonitorStatus, 1000); // Actualizar cada segundo
        }
        
        // Funci√≥n para actualizar estad√≠sticas (eliminada)
        function updateSuperChatStats() {
            // Estad√≠sticas eliminadas - funci√≥n vac√≠a
        }
        
        // Funci√≥n para obtener tier de color seg√∫n monto USD
        function getTierClass(montoUSD) {
            if (montoUSD >= 100) return 'tier-6';      // $100+ - P√∫rpura
            if (montoUSD >= 50) return 'tier-5';       // $50-99 - Rojo
            if (montoUSD >= 20) return 'tier-4';       // $20-49 - Naranja
            if (montoUSD >= 10) return 'tier-3';       // $10-19 - Verde
            if (montoUSD >= 5) return 'tier-2';        // $5-9 - Cyan
            return 'tier-1';                           // $1-4 - Azul
        }

        // Mapeo de nombres de concursantes a im√°genes
        const contestantImages = {
            'GIGI': 'images/gigi.jpg',
            'GIUSEPPE': 'images/GIUSEPPE.jpg',
            'VLADY': 'images/vlady.jpg',
            'CRAZY': 'images/CRAZY.jpg',
            'PAMELA': 'images/pamela.jpg',
            'KAROLA': 'images/karola.jpg',
            'JIMENEZ': 'images/JIMENEZ.jpg',
            'PEKY': 'images/peki.jpg',
            'CRUSITA': 'images/CRUSITA.jpg',
            'LUISE': 'images/luise.jpg',
            'CARLOS': 'images/carlos.png'
        };

        // Funci√≥n para generar HTML de im√°genes de concursantes
        function generateContestantImages(concursantes) {
            if (!concursantes || !Array.isArray(concursantes)) {
                return '<div class="contestants-images"></div>';
            }
            
            // Si son 11 concursantes (todos), mostrar todas las im√°genes
            if (concursantes.length === 11) {
                const allImages = concursantes.map(name => {
                    return `<img src="${contestantImages[name]}" alt="${name}" class="contestant-mini-img" title="${name}">`;
                }).join('');
                return `<div class="contestants-images multiple">${allImages}</div>`;
            } else {
                // Para concursantes espec√≠ficos
                const images = concursantes.map(name => {
                    const imageSrc = contestantImages[name];
                    if (imageSrc) {
                        return `<img src="${imageSrc}" alt="${name}" class="contestant-mini-img" title="${name}">`;
                    }
                    return '';
                }).filter(img => img).join('');
                
                const multipleClass = concursantes.length > 1 ? 'multiple' : '';
                return `<div class="contestants-images ${multipleClass}">${images}</div>`;
            }
        }

        // Funci√≥n para formatear texto de concursantes con im√°genes y progresi√≥n
        function formatContestantsText(concursantes, puntosDistribuidos, distribucion, puntuacionesAnteriores) {
            if (!concursantes || !Array.isArray(concursantes)) {
                return '<div class="contestants-text">Sin informaci√≥n de concursantes</div>';
            }
            
            const images = generateContestantImages(concursantes);
            
            let text = '';
            // Si son 11 concursantes (todos), es un caso "SIN CLASIFICAR"
            if (concursantes.length === 11) {
                // Verificar si no se asignaron puntos por monto muy bajo
                if (distribucion && distribucion.includes("m√≠nimo $10 requerido")) {
                    text = `Todos los participantes (0 pts - monto insuficiente)`;
                } else {
                    text = `Todos los participantes (${puntosDistribuidos} pts c/u)`;
                }
            } else {
                // Para concursantes espec√≠ficos, mostrar progresi√≥n de puntos
                if (puntuacionesAnteriores && Object.keys(puntuacionesAnteriores).length > 0) {
                    const participantesConProgresion = concursantes.map(nombre => {
                        const puntosAnteriores = puntuacionesAnteriores[nombre] || 0;
                        const puntosNuevos = puntosAnteriores + puntosDistribuidos;
                        return `${nombre}: ${puntosAnteriores} + ${puntosDistribuidos} = ${puntosNuevos} pts`;
                    });
                    text = participantesConProgresion.join('<br>‚Üí ');
                    text = '‚Üí ' + text;
                } else {
                    // Fallback al formato anterior si no hay puntuaciones anteriores
                    const participantes = concursantes.join(', ');
                    const puntosCadaUno = concursantes.length > 1 ? ` (${puntosDistribuidos} pts c/u)` : ` (${puntosDistribuidos} pts)`;
                    text = `${participantes}${puntosCadaUno}`;
                }
            }
            
            return `${images}<span class="contestants-text">${text}</span>`;
        }

        // Funci√≥n para agregar SuperChat
        function addSuperChat(superChatData) {
            const superChatsList = document.getElementById('superchats-list');
            
            // Remover mensaje de "no superchats" si existe
            const noSuperChats = superChatsList.querySelector('.no-superchats');
            if (noSuperChats) {
                noSuperChats.remove();
            }
            
            // Crear elemento de SuperChat
            const superChatElement = document.createElement('div');
            superChatElement.className = 'superchat-item';
            
            const timeString = new Date(superChatData.timestamp).toLocaleTimeString('es-DO', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            // Obtener tier de color
            const tierClass = getTierClass(superChatData.amount);
            
            // Formatear texto de concursantes
            const contestantsText = formatContestantsText(
                superChatData.contestants, 
                superChatData.pointsPerContestant, 
                superChatData.distribucion,
                superChatData.puntuacionesAnteriores
            );
            const contestantsClass = superChatData.contestants && superChatData.contestants.length === 10 ? 'sin-clasificar' : '';
            
            // Mostrar conversi√≥n de moneda si es diferente
            const conversionText = (superChatData.originalAmount && superChatData.originalCurrency && superChatData.originalCurrency !== 'USD') ?
                `<div class="superchat-conversion">${superChatData.originalAmount} ${superChatData.originalCurrency} ‚Üí $${superChatData.amount} USD</div>` : '';
            
            superChatElement.innerHTML = `
                <div class="superchat-header">
                    <div class="superchat-author">${superChatData.author}</div>
                    <div class="superchat-amount ${tierClass}">
                        $${superChatData.amount}
                        ${conversionText}
                    </div>
                </div>
                                    <div class="superchat-message">${superChatData.message || 'Sin mensaje'}</div>
                <div class="superchat-footer">
                    <div class="superchat-contestants ${contestantsClass}">${contestantsText}</div>
                    <div class="superchat-time">${timeString}</div>
                </div>
            `;
            
            // Detectar si el usuario est√° al final ANTES de agregar el SuperChat
            const wasAtBottom = isUserAtBottom();
            
            // Agregar al inicio de la lista (m√°s recientes arriba)
            superChatsList.insertBefore(superChatElement, superChatsList.firstChild);
            
            // Actualizar estad√≠sticas (aunque no se muestren, mantener la l√≥gica)
            totalSuperChats++;
            totalAmount += superChatData.amount;
            updateSuperChatStats();
            
            // Actualizar indicador de estado
            lastSuperChatTime = superChatData.timestamp;
            sessionSuperChats++;
            monitorActive = true; // Si llegan SuperChats, el monitor est√° activo
            
            // SCROLL INTELIGENTE
            if (wasAtBottom && autoScroll) {
                // Si estaba al final, hacer scroll autom√°tico
                setTimeout(scrollToBottom, 100);
                userIsReading = false;
            } else {
                // Si no estaba al final, el usuario est√° leyendo
                userIsReading = true;
                pendingNewChats++;
                updateNewChatsNotification();
            }
            
            // Animar entrada
            superChatElement.style.animation = 'slideInRight 0.5s ease-out';
        }
        
        // Funci√≥n para solicitar puntuaciones via WebSocket
        function requestScores() {
            if (isConnected) {
                socket.emit('get-puntuaciones');
            } else {
                console.log('‚ùå WebSocket no conectado, no se pueden obtener puntuaciones');
            }
        }



        // Links de Instagram de los concursantes
        const instagramLinks = {
            gigi: 'https://www.instagram.com/lagigird/',
            giuseppe: 'https://www.instagram.com/gbenignini/', // Ejemplo - ajustar con el real
            vlady: 'https://www.instagram.com/justvladyg/', // Ejemplo - ajustar con el real
            crazy: 'https://www.instagram.com/crazydesignrd/', // Ejemplo - ajustar con el real
            pamela: 'https://www.instagram.com/shuupamela6.9/', // Ejemplo - ajustar con el real
            karola: 'https://www.instagram.com/karolalcendra_/', // Ejemplo - ajustar con el real
            jimenez: 'https://www.instagram.com/jimenez_tv/', // Ejemplo - ajustar con el real
            peky: 'https://www.instagram.com/lapekipr/', // Ejemplo - ajustar con el real
            crusita: 'https://www.instagram.com/crusita___/', // Ejemplo - ajustar con el real
            luise: 'https://www.instagram.com/luisemartinezz12/', // Ejemplo - ajustar con el real
            carlos: 'https://www.instagram.com/carlosuser/' // Ejemplo - ajustar con el real
        };

        // Variables para el modal de historial
        let currentContestant = null;
        let currentPage = 1;
        let hasMoreHistory = false;
        let isLoadingHistory = false;

        // Funci√≥n para abrir el historial del concursante
        function openContestantProfile(contestantId) {
            currentContestant = contestantId;
            currentPage = 1;
            hasMoreHistory = false;
            
            // Actualizar nombre en el modal
            const contestantName = document.querySelector(`[onclick="openContestantProfile('${contestantId}')"]`).closest('.contestant-card, .position-item').querySelector('.contestant-name, .position-name').textContent;
            document.getElementById('modal-contestant-name').textContent = contestantName;
            
            // Mostrar modal
            document.getElementById('history-modal').style.display = 'flex';
            
            // Cargar historial
            loadContestantHistory();
        }

        // Funci√≥n para cerrar el modal
        function closeHistoryModal() {
            document.getElementById('history-modal').style.display = 'none';
            currentContestant = null;
            currentPage = 1;
            hasMoreHistory = false;
        }

        // Funci√≥n para cargar historial del concursante
        function loadContestantHistory() {
            if (!currentContestant || isLoadingHistory) return;
            
            isLoadingHistory = true;
            
            // Mostrar loading
            const historyList = document.getElementById('history-list');
            if (currentPage === 1) {
                historyList.innerHTML = '<div class="loading-indicator">Cargando historial...</div>';
            }
            
            // Solicitar historial via WebSocket
            socket.emit('get-superchats-history', {
                contestant: currentContestant,
                limit: 20,
                page: currentPage
            });
        }

        // Funci√≥n para cargar m√°s historial
        function loadMoreHistory() {
            if (hasMoreHistory && !isLoadingHistory) {
                currentPage++;
                loadContestantHistory();
            }
        }

        // Funci√≥n para abrir Instagram
        function openInstagram() {
            if (currentContestant) {
                const instagramUrl = instagramLinks[currentContestant];
                if (instagramUrl) {
                    window.open(instagramUrl, '_blank');
                } else {
                    alert('Instagram del concursante no disponible a√∫n');
                }
            }
        }

        // Funci√≥n para renderizar la lista de historial
        function renderHistoryList(data, isFirstPage = false) {
            const historyList = document.getElementById('history-list');
            const loadMoreBtn = document.getElementById('load-more-btn');
            
            if (isFirstPage) {
                historyList.innerHTML = '';
            }
            
                            if (!data || data.length === 0) {
                    if (isFirstPage) {
                        historyList.innerHTML = `
                            <div class="no-history">
                                <div class="no-history-icon">üìù</div>
                                <div class="no-history-text">No hay SuperChats asignados</div>
                                <div class="no-history-subtext">Solo se muestran SuperChats donde este concursante recibi√≥ puntos</div>
                            </div>
                        `;
                    }
                    loadMoreBtn.style.display = 'none';
                    return;
                }
            
            data.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                // Formatear fecha
                const date = new Date(item.created_at);
                const timeString = date.toLocaleTimeString('es-DO', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true
                });
                const dateString = date.toLocaleDateString('es-DO', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                // Obtener tier de color
                const tierClass = getTierClass(item.amount_usd);
                
                // Mostrar conversi√≥n si es diferente
                const conversionText = (item.original_currency && item.original_currency !== 'USD') ?
                    `${item.original_amount} ${item.original_currency} ‚Üí $${item.amount_usd} USD` : '';
                
                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-author">${item.author}</div>
                        <div class="history-amount ${tierClass}">$${item.amount_usd}</div>
                    </div>
                    <div class="history-message">${item.message || 'Sin mensaje'}</div>
                    <div class="history-details">
                        ${conversionText ? `<div class="history-conversion">${conversionText}</div>` : ''}
                        <div class="history-time">${dateString} - ${timeString}</div>
                        <div class="history-points">+${item.points_assigned} pts</div>
                    </div>
                `;
                
                historyList.appendChild(historyItem);
            });
            
            // Mostrar/ocultar bot√≥n "Cargar m√°s"
            loadMoreBtn.style.display = hasMoreHistory ? 'block' : 'none';
        }

        // Funci√≥n para detectar cambios de posici√≥n y aplicar animaciones
        function detectPositionChanges(concursantes) {
            const currentPositions = {};
            const positionChanges = [];
            
            // Crear mapa de posiciones actuales
            concursantes.forEach((concursante, index) => {
                currentPositions[concursante.slug] = index + 1;
            });
            
            // Comparar con posiciones anteriores
            Object.keys(currentPositions).forEach(slug => {
                const currentPos = currentPositions[slug];
                const previousPos = previousPositions[slug];
                
                if (previousPos && previousPos !== currentPos) {
                    positionChanges.push({
                        slug: slug,
                        from: previousPos,
                        to: currentPos,
                        direction: currentPos < previousPos ? 'up' : 'down'
                    });
                }
            });
            
            // Actualizar posiciones anteriores
            previousPositions = { ...currentPositions };
            
            return positionChanges;
        }

        // Funci√≥n para aplicar animaciones de cambio de posici√≥n
        function applyPositionAnimations(positionChanges) {
            positionChanges.forEach(change => {
                // Animar en vista principal (grid)
                const mainCard = document.querySelector(`#score-${change.slug}`)?.closest('.contestant-card');
                // Animar en vista de lista
                const listItem = document.querySelector(`[data-contestant="${change.slug}"]`);
                
                const elements = [mainCard, listItem].filter(el => el);
                
                elements.forEach(element => {
                    // Remover animaciones anteriores
                    element.classList.remove('moving-up', 'moving-down', 'position-changed', 'new-leader');
                    
                    // Aplicar nueva animaci√≥n seg√∫n el tipo de cambio
                    if (change.direction === 'up') {
                        element.classList.add('moving-up');
                        
                        // Efecto especial si llega al primer lugar
                        if (change.to === 1) {
                            setTimeout(() => {
                                element.classList.remove('moving-up');
                                element.classList.add('new-leader');
                            }, 1500);
                        }
                    } else {
                        element.classList.add('moving-down');
                    }
                    
                    // Remover clase despu√©s de la animaci√≥n
                    setTimeout(() => {
                        element.classList.remove('moving-up', 'moving-down', 'position-changed');
                    }, change.direction === 'up' && change.to === 1 ? 3500 : 1500);
                });
                
            });
        }

        // Funci√≥n para reordenar concursantes seg√∫n puntuaci√≥n con animaciones
        function reorderContestants(concursantes) {
            const container = document.querySelector('.contestants-grid');
            const cards = Array.from(container.children);
            
            // Separar participantes activos y eliminados
            const participantesActivos = concursantes.filter(c => !c.eliminado);
            const participantesEliminados = concursantes.filter(c => c.eliminado);
            
            // Detectar cambios de posici√≥n ANTES del reordenamiento (solo para activos)
            const positionChanges = detectPositionChanges(participantesActivos);
            
            // Crear un mapa de las cards actuales por slug
            const cardMap = {};
            cards.forEach(card => {
                const scoreElement = card.querySelector('.contestant-score');
                const id = scoreElement.id;
                if (id && id.startsWith('score-')) {
                    const slug = id.replace('score-', '');
                    cardMap[slug] = card;
                }
            });
            
            // Aplicar clase de reordenamiento
            container.classList.add('reordering');
            
            // Reordenar: primero activos por puntos, luego eliminados
            container.innerHTML = '';
            
            // Agregar participantes activos ordenados por puntos
            participantesActivos.forEach(concursante => {
                const card = cardMap[concursante.slug];
                if (card) {
                    container.appendChild(card);
                } else {
                    console.warn(`No se encontr√≥ card para: ${concursante.slug}`);
                }
            });
            
            // Agregar participantes eliminados al final
            participantesEliminados.forEach(concursante => {
                const card = cardMap[concursante.slug];
                if (card) {
                    container.appendChild(card);
                } else {
                    console.warn(`No se encontr√≥ card para: ${concursante.slug}`);
                }
            });
            
            // Remover clase de reordenamiento y aplicar animaciones
            setTimeout(() => {
                container.classList.remove('reordering');
                
                // Aplicar animaciones de cambio de posici√≥n (solo para activos)
                if (positionChanges.length > 0) {
                    applyPositionAnimations(positionChanges);
                }
            }, 100);
        }

        // Funci√≥n para actualizar tabla de posiciones en lista con animaciones
        function updatePositionsList(concursantes) {
            const positionsList = document.querySelector('.positions-list');
            if (!positionsList) return;

            const positionItems = Array.from(positionsList.children);
            
            // Separar participantes activos y eliminados
            const participantesActivos = concursantes.filter(c => !c.eliminado);
            const participantesEliminados = concursantes.filter(c => c.eliminado);
            
            // Crear un mapa de los items por contestant
            const itemMap = {};
            positionItems.forEach(item => {
                const contestant = item.getAttribute('data-contestant');
                if (contestant) {
                    itemMap[contestant] = item;
                }
            });
            
            // Aplicar clase de reordenamiento
            positionsList.classList.add('reordering');
            
            // Reordenar y actualizar
            positionsList.innerHTML = '';
            
            // Primero agregar participantes activos con ranking normal
            participantesActivos.forEach((concursante, index) => {
                const item = itemMap[concursante.slug];
                if (item) {
                    // Actualizar ranking (posici√≥n real en competencia)
                    const rankElement = item.querySelector('.position-rank');
                    if (rankElement) {
                        rankElement.textContent = index + 1;
                    }
                    
                    // Actualizar puntos
                    const scoreElement = item.querySelector('.position-score');
                    if (scoreElement) {
                        scoreElement.textContent = `${Math.round(concursante.puntos_reales)} PTS`;
                    }
                    
                    // Agregar √≠ndice para animaci√≥n
                    item.style.setProperty('--item-index', index);
                    
                    positionsList.appendChild(item);
                } else {
                    console.warn(`No se encontr√≥ position item para: ${concursante.slug}`);
                }
            });
            
            // Luego agregar participantes eliminados al final (sin ranking num√©rico)
            participantesEliminados.forEach((concursante, index) => {
                const item = itemMap[concursante.slug];
                if (item) {
                    // Para eliminados, mostrar "X" en lugar de n√∫mero
                    const rankElement = item.querySelector('.position-rank');
                    if (rankElement) {
                        rankElement.textContent = 'X';
                    }
                    
                    // Actualizar puntos a "ELIMINADO"
                    const scoreElement = item.querySelector('.position-score');
                    if (scoreElement) {
                        scoreElement.textContent = 'ELIMINADO';
                    }
                    
                    // Agregar √≠ndice para animaci√≥n
                    const totalIndex = participantesActivos.length + index;
                    item.style.setProperty('--item-index', totalIndex);
                    
                    positionsList.appendChild(item);
                } else {
                    console.warn(`No se encontr√≥ position item para: ${concursante.slug}`);
                }
            });
            
            // Remover clase de reordenamiento
            setTimeout(() => {
                positionsList.classList.remove('reordering');
            }, 100);
        }

        // Funci√≥n para actualizar la hora de √∫ltima actualizaci√≥n
        function updateLastUpdateTime() {
            const now = new Date();
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true,
                timeZone: 'America/Santo_Domingo'
            };
            
            const timeString = now.toLocaleTimeString('es-DO', options);
            const dateString = now.toLocaleDateString('es-DO', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                timeZone: 'America/Santo_Domingo'
            });
            
            document.getElementById('last-update').textContent = `${dateString} - ${timeString}`;
        }

        // WebSocket Event Listeners
        socket.on('connect', () => {
            isConnected = true;
            // Solicitar puntuaciones iniciales al conectar
            requestScores();
            // Actualizar estado inmediatamente
            updateMonitorStatus();
        });
        
        socket.on('disconnect', () => {
            isConnected = false;
            monitorActive = false; // Si se desconecta, el monitor no est√° activo
            updateMonitorStatus();
        });
        
        socket.on('puntuaciones-update', (data) => {
            if (data.success) {
                // Lista de participantes eliminados
                const eliminatedContestants = ['pamela', 'jimenez', 'peky'];
                
                // Actualizar tabla principal (vista puntuaciones)
                reorderContestants(data.data);
                data.data.forEach((concursante) => {
                    const scoreElement = document.getElementById(`score-${concursante.slug}`);
                    if (scoreElement) {
                        // Si el participante est√° eliminado, mantener "ELIMINADO"
                        if (eliminatedContestants.includes(concursante.slug)) {
                            scoreElement.textContent = 'ELIMINADO';
                        } else {
                            scoreElement.textContent = `${Math.round(concursante.puntos_reales)}PTS`;
                        }
                    }
                });
                
                // Actualizar tabla de posiciones en lista (vista combinada)
                updatePositionsList(data.data);
                
                // Actualizar la hora de √∫ltima actualizaci√≥n cuando se reciben nuevas puntuaciones
                updateLastUpdateTime();
            }
        });
        
        socket.on('estadisticas-update', (stats) => {
            // actualizarEstadisticasPanel(stats); // This function is not defined in the original file
        });


        
        socket.on('dia-actualizado', (info) => {
            console.log('üìÖ D√≠a del reality actualizado:', info);
            // actualizarDiaEnHeader(info.diaActual, info.titulo); // This function is not defined in the original file
        });
        
        socket.on('monitor-status', (status) => {
            // Actualizar estado del monitor basado en la informaci√≥n del servidor
            monitorActive = status.isActive || false;
            updateMonitorStatus();
        });
        
        // Funci√≥n para actualizar estad√≠sticas del panel
        function actualizarEstadisticasPanel(stats) {
        }
        
        // Funci√≥n para actualizar el d√≠a en el header
        function actualizarDiaEnHeader(dia, titulo) {
            const dayNumberElement = document.querySelector('.day-number');
            const dayTextElement = document.querySelector('.day-text');
            
            if (dayNumberElement) {
                // Animaci√≥n de cambio
                dayNumberElement.style.transform = 'scale(1.2)';
                dayNumberElement.style.color = '#FFD700';
                
                setTimeout(() => {
                    dayNumberElement.textContent = dia;
                    setTimeout(() => {
                        dayNumberElement.style.transform = 'scale(1)';
                        dayNumberElement.style.color = '#ffffff';
                    }, 200);
                }, 100);
            }
            
            // Opcional: actualizar el t√≠tulo en la consola para debug
            if (titulo) {
            }
            
            // Notificaci√≥n eliminada - solo actualiza silenciosamente
        }
        
        // Funci√≥n para animar concursantes que recibieron puntos
        function animarConcursantesQueRecibieronPuntos(concursantesNombres) {
            concursantesNombres.forEach(nombreConcursante => {
                // Buscar la card por el nombre del concursante en ambas vistas
                const cards = document.querySelectorAll('.contestant-card, .position-item');
                cards.forEach(card => {
                    const nombreElement = card.querySelector('.contestant-name, .position-name');
                    if (nombreElement && nombreElement.textContent.trim() === nombreConcursante) {
                        // Animar la card
                        card.classList.add('points-received');
                        
                        // Remover la animaci√≥n despu√©s de que termine
                        setTimeout(() => {
                            card.classList.remove('points-received');
                        }, 1000);
                    }
                });
            });
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            updateLastUpdateTime(); // Actualizar hora inmediatamente
            
            // Actualizar hora cada 5 minutos (solo la hora, los datos vienen por WebSocket)
            setInterval(() => {
                updateLastUpdateTime();
            }, 300000);

            // Inicializar controles de switch y SuperChats
            initViewSwitch();
            initSuperChatControls();

            // Event listener para el bot√≥n "Ver nuevos SuperChats"
            document.getElementById('new-chats-button').addEventListener('click', goToNewChats);

            // Inicializar indicador de estado
            startStatusUpdater();
            updateMonitorStatus(); // Actualizar estado inicial

            // Event listener para cerrar modal con ESC
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeHistoryModal();
                }
            });

            // Event listener para cerrar modal haciendo click fuera
            document.getElementById('history-modal').addEventListener('click', function(event) {
                if (event.target === this) {
                    closeHistoryModal();
                }
            });



            // Escuchar mensajes de SuperChats en tiempo real
            socket.on('nuevo-superchat', (superChatData) => {
                addSuperChat(superChatData);
                // Animar concursantes que recibieron puntos si el mensaje incluye a alguien
                if (superChatData.contestants && superChatData.contestants.length > 0) {
                    animarConcursantesQueRecibieronPuntos(superChatData.contestants);
                }
            });

            // Escuchar respuesta del historial de SuperChats
            socket.on('superchats-history', (response) => {
                isLoadingHistory = false;
                
                if (response.success) {
                    hasMoreHistory = response.hasMore;
                    renderHistoryList(response.data, response.page === 1);
                } else {
                    console.error('‚ùå Error obteniendo historial:', response.error);
                    const historyList = document.getElementById('history-list');
                    historyList.innerHTML = `
                        <div class="no-history">
                            <div class="no-history-icon">‚ùå</div>
                            <div class="no-history-text">Error al cargar historial</div>
                            <div class="no-history-subtext">${response.error}</div>
                        </div>
                    `;
                }
            });
        });
    </script>
</body>
</html> 