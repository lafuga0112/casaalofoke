<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Puntuaciones - Alofoke Reality Show</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="images/fav.jpg" type="image/jpeg">
    <meta name="description" content="Tabla de Puntuaciones - Alofoke Reality Show">
    <meta name="keywords" content="Alofoke, Reality Show, Puntuaciones, Tabla de Puntuaciones">
    <meta name="author" content="Alofoke">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="google" content="notranslate">
    <meta name="google-site-verification" content="google-site-verification=google-site-verification">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2567586545384813"
     crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">

</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2650HKVSYV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2650HKVSYV');
</script>
<body>
    <!-- Header Principal -->
    <header class="header">
        <div class="header-content">

            <div class="social-header">
                <div class="social-message">
                    <span class="social-message-text">Disfruta del Reality en los canales oficiales</span>
                </div>
                <div class="social-links">
                    <a href="https://www.instagram.com/casaalofoke/" target="_blank" class="social-header-link instagram">
                        <img src="images/ig.png" alt="Instagram" class="social-header-icon">
                        <span class="social-header-text">@casaalofoke</span>
                    </a>
                    <a href="https://www.youtube.com/watch?app=desktop&v=gOJvu0xYsdo&fbclid=PAZXh0bgNhZW0CMTEAAaeucH45DPPbuwn5_nzesxOrArvYTOJWZbaATMYH-nwcS3XmuLiTHjP4lZ8EFg_aem_fzVrWP8OPCdZxhL7yXspLg" target="_blank" class="social-header-link youtube">
                        <img src="images/yt.png" alt="YouTube" class="social-header-icon">
                        <span class="social-header-text">Alofoke Radio Show</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor Principal -->
    <main class="main-container">
        <!-- Switch de Vista -->
        <section class="view-switch">
            <div class="switch-container">
                <span class="switch-label">Puntuaciones</span>
                <label class="switch">
                    <input type="checkbox" id="view-toggle">
                    <span class="slider"></span>
                </label>
                <span class="switch-label">SuperChats En Vivo</span>
            </div>
        </section>

        <!-- Vista Solo Puntuaciones -->
        <section class="contestants-panel" id="puntuaciones-view">
            <div class="contestants-grid">
                <!-- LA GIGI -->
                <div class="contestant-card" style="--card-index: 0;">
                    <div class="contestant-name">LA GIGI</div>
                    <div class="contestant-photo">
                        <img src="images/gigi.jpg" alt="LA GIGI" class="profile-img" onclick="openContestantProfile('gigi')">
                    </div>
                    <div class="contestant-score" id="score-gigi">0PTS</div>
                </div>

                <!-- GIUSEPPE/TRUJILLO -->
                <div class="contestant-card" style="--card-index: 1;">
                    <div class="contestant-name">GIUSEPPE</div>
                    <div class="contestant-photo">
                        <img src="images/GIUSEPPE.jpg" alt="GIUSEPPE" class="profile-img" onclick="openContestantProfile('giuseppe')">
                    </div>
                    <div class="contestant-score" id="score-giuseppe">0PTS</div>
                </div>

                <!-- VLADY -->
                <div class="contestant-card" style="--card-index: 2;">
                    <div class="contestant-name">VLADY</div>
                    <div class="contestant-photo">
                        <img src="images/vlady.jpg" alt="VLADY" class="profile-img" onclick="openContestantProfile('vlady')">
                    </div>
                    <div class="contestant-score" id="score-vlady">0PTS</div>
                </div>

                <!-- CRAZY -->
                <div class="contestant-card" style="--card-index: 3;">
                    <div class="contestant-name">CRAZY</div>
                    <div class="contestant-photo">
                        <img src="images/CRAZY.jpg" alt="CRAZY" class="profile-img" onclick="openContestantProfile('crazy')">
                    </div>
                    <div class="contestant-score" id="score-crazy">0PTS</div>
                </div>

                <!-- Pamela -->
                <div class="contestant-card" style="--card-index: 4;">
                    <div class="contestant-name">PAMELA</div>
                    <div class="contestant-photo">
                        <img src="images/pamela.jpg" alt="PAMELA" class="profile-img" onclick="openContestantProfile('pamela')">
                    </div>
                    <div class="contestant-score" id="score-pamela">0PTS</div>
                </div>

                <!-- KAROLA -->
                <div class="contestant-card" style="--card-index: 5;">
                    <div class="contestant-name">KAROLA</div>
                    <div class="contestant-photo">
                        <img src="images/karola.jpg" alt="KAROLA" class="profile-img" onclick="openContestantProfile('karola')">
                    </div>
                    <div class="contestant-score" id="score-karola">0PTS</div>
                </div>

                <!-- JIMENEZ -->
                <div class="contestant-card" style="--card-index: 6;">
                    <div class="contestant-name">JIMENEZ</div>
                    <div class="contestant-photo">
                        <img src="images/JIMENEZ.jpg" alt="JIMENEZ" class="profile-img" onclick="openContestantProfile('jimenez')">
                    </div>
                    <div class="contestant-score" id="score-jimenez">0PTS</div>
                </div>

                <!-- LA PEKI -->
                <div class="contestant-card" style="--card-index: 7;">
                    <div class="contestant-name">LA PEKI</div>
                    <div class="contestant-photo">
                        <img src="images/peki.jpg" alt="LA PEKI" class="profile-img" onclick="openContestantProfile('peki')">
                    </div>
                    <div class="contestant-score" id="score-peky">0PTS</div>
                </div>

                <!-- CRUSITA -->
                <div class="contestant-card" style="--card-index: 8;">
                    <div class="contestant-name">CRUSITA</div>
                    <div class="contestant-photo">
                        <img src="images/CRUSITA.jpg" alt="CRUSITA" class="profile-img" onclick="openContestantProfile('crusita')">
                    </div>
                    <div class="contestant-score" id="score-crusita">0PTS</div>
                </div>

                <!-- LUISE -->
                <div class="contestant-card" style="--card-index: 9;">
                    <div class="contestant-name">LUISE</div>
                    <div class="contestant-photo">
                        <img src="images/luise.jpg" alt="LUISE" class="profile-img" onclick="openContestantProfile('luise')">
                    </div>
                    <div class="contestant-score" id="score-luise">0PTS</div>
                </div>
            </div>
            
            <!-- Leyenda del Sistema de Puntuación -->
            <div class="scoring-legend">
                <div class="legend-header">
                    <h3>INFORMACIÓN DEL SISTEMA DE PUNTUACIÓN</h3>
                </div>
                <div class="legend-content">
                    <div class="legend-item">
                        <span class="legend-label">Contabilización desde:</span>
                        <span class="legend-value">13 de Agosto, 2025 - 1:30 AM</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-label">Última actualización:</span>
                        <span class="legend-value" id="last-update">--:-- --</span>
                    </div>
                </div>
                
                <!-- Información sobre distribución de puntos -->
                <div class="legend-content distribution-info">
                    <div class="legend-item">
                        <span class="legend-label">¿Cómo se reparten los puntos?</span>
                        <span class="legend-value">
                            Cuando un SuperChat menciona a varios concursantes en un mismo mensaje, los puntos se dividen equitativamente entre ellos.
                            Por ejemplo, si un SuperChat de $10 menciona a GIGI y VLADY, cada uno recibe 5 puntos.
                        </span>
                    </div>
                </div>
                
                <!-- Disclaimer Legal -->
                <div class="disclaimer">
                    <div class="disclaimer-content">
                        <span class="disclaimer-text">
                            <strong>IMPORTANTE:</strong> Este sistema de puntuación NO es un conteo oficial de parte de la empresa Alofoke. 
                            Fue creado por un fan como herramienta informativa y de entretenimiento. 
                            Los resultados pueden no reflejar la puntuación real del reality show.
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista Combinada: SuperChats (Izquierda) + Tabla Lista (Derecha) -->
        <section class="live-view" id="superchats-view" style="display: none;">
            <!-- Panel de SuperChats (Izquierda) -->
            <div class="superchats-panel">
                <div class="superchats-header">
                    <div class="superchats-title">
                        <h2>SUPERCHATS EN VIVO</h2>
                    </div>
                </div>
                
                <div class="superchats-container">
                    <div class="superchats-list" id="superchats-list">
                        <!-- Los SuperChats se mostrarán aquí -->
                        <div class="no-superchats">
                            <div class="no-superchats-text">Esperando SuperChats...</div>
                            <div class="no-superchats-subtext">Los SuperChats aparecerán aquí en tiempo real</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabla de Posiciones en Lista (Derecha) -->
            <div class="positions-list-panel">
                <div class="positions-header">
                    <h2>TABLA DE POSICIONES</h2>
                    <div class="positions-subtitle">Actualizada en tiempo real</div>
                </div>
                <div class="positions-list">
                    <!-- LA GIGI -->
                    <div class="position-item" data-contestant="gigi">
                        <div class="position-rank">1</div>
                        <div class="position-avatar">
                            <img src="images/gigi.jpg" alt="LA GIGI" class="position-img" onclick="openContestantProfile('gigi')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LA GIGI</div>
                            <div class="position-score" id="list-score-gigi">0 PTS</div>
                        </div>
                    </div>

                    <!-- GIUSEPPE -->
                    <div class="position-item" data-contestant="giuseppe">
                        <div class="position-rank">2</div>
                        <div class="position-avatar">
                            <img src="images/GIUSEPPE.jpg" alt="GIUSEPPE" class="position-img" onclick="openContestantProfile('giuseppe')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">GIUSEPPE</div>
                            <div class="position-score" id="list-score-giuseppe">0 PTS</div>
                        </div>
                    </div>

                    <!-- VLADY -->
                    <div class="position-item" data-contestant="vlady">
                        <div class="position-rank">3</div>
                        <div class="position-avatar">
                            <img src="images/vlady.jpg" alt="VLADY" class="position-img" onclick="openContestantProfile('vlady')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">VLADY</div>
                            <div class="position-score" id="list-score-vlady">0 PTS</div>
                        </div>
                    </div>

                    <!-- CRAZY -->
                    <div class="position-item" data-contestant="crazy">
                        <div class="position-rank">4</div>
                        <div class="position-avatar">
                            <img src="images/CRAZY.jpg" alt="CRAZY" class="position-img" onclick="openContestantProfile('crazy')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">CRAZY</div>
                            <div class="position-score" id="list-score-crazy">0 PTS</div>
                        </div>
                    </div>

                    <!-- PAMELA -->
                    <div class="position-item" data-contestant="pamela">
                        <div class="position-rank">5</div>
                        <div class="position-avatar">
                            <img src="images/pamela.jpg" alt="PAMELA" class="position-img" onclick="openContestantProfile('pamela')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">PAMELA</div>
                            <div class="position-score" id="list-score-pamela">0 PTS</div>
                        </div>
                    </div>

                    <!-- KAROLA -->
                    <div class="position-item" data-contestant="karola">
                        <div class="position-rank">6</div>
                        <div class="position-avatar">
                            <img src="images/karola.jpg" alt="KAROLA" class="position-img" onclick="openContestantProfile('karola')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">KAROLA</div>
                            <div class="position-score" id="list-score-karola">0 PTS</div>
                        </div>
                    </div>

                    <!-- JIMENEZ -->
                    <div class="position-item" data-contestant="jimenez">
                        <div class="position-rank">7</div>
                        <div class="position-avatar">
                            <img src="images/JIMENEZ.jpg" alt="JIMENEZ" class="position-img" onclick="openContestantProfile('jimenez')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">JIMENEZ</div>
                            <div class="position-score" id="list-score-jimenez">0 PTS</div>
                        </div>
                    </div>

                    <!-- LA PEKI -->
                    <div class="position-item" data-contestant="peky">
                        <div class="position-rank">8</div>
                        <div class="position-avatar">
                            <img src="images/peki.jpg" alt="LA PEKI" class="position-img" onclick="openContestantProfile('peky')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LA PEKI</div>
                            <div class="position-score" id="list-score-peky">0 PTS</div>
                        </div>
                    </div>

                    <!-- CRUSITA -->
                    <div class="position-item" data-contestant="crusita">
                        <div class="position-rank">9</div>
                        <div class="position-avatar">
                            <img src="images/CRUSITA.jpg" alt="CRUSITA" class="position-img" onclick="openContestantProfile('crusita')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">CRUSITA</div>
                            <div class="position-score" id="list-score-crusita">0 PTS</div>
                        </div>
                    </div>

                    <!-- LUISE -->
                    <div class="position-item" data-contestant="luise">
                        <div class="position-rank">10</div>
                        <div class="position-avatar">
                            <img src="images/luise.jpg" alt="LUISE" class="position-img" onclick="openContestantProfile('luise')">
                        </div>
                        <div class="position-details">
                            <div class="position-name">LUISE</div>
                            <div class="position-score" id="list-score-luise">0 PTS</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Script para actualizar puntuaciones en tiempo real -->
    <script>
        // Conexión WebSocket
        const socket = io({
            transports: ['websocket', 'polling'],
            path: '/socket.io',
            reconnection: true,
            reconnectionAttempts: 10,
            reconnectionDelay: 5000,
            reconnectionDelayMax: 60000,
            timeout: 60000
        });
        
        // Variables globales
        let isConnected = false;
        let autoScroll = true;
        let totalSuperChats = 0;
        let totalAmount = 0;
        let previousPositions = {}; // Para rastrear posiciones anteriores
        
        // Función para manejar el switch de vista
        function initViewSwitch() {
            const viewToggle = document.getElementById('view-toggle');
            const puntuacionesView = document.getElementById('puntuaciones-view');
            const superchatsView = document.getElementById('superchats-view');
            const switchLabels = document.querySelectorAll('.switch-label');
            
            // Función para detectar si estamos en móvil
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // Función para mostrar/ocultar vistas correctamente
            function updateViews(showSuperChats) {
                if (showSuperChats) {
                    // Mostrar vista SuperChats
                    puntuacionesView.style.display = 'none';
                    
                    // Usar el display apropiado según el tamaño de pantalla
                    if (isMobile()) {
                        superchatsView.style.display = 'flex';
                    } else {
                        superchatsView.style.display = 'grid';
                    }
                    
                    // Actualizar labels
                    switchLabels[0].classList.remove('active');
                    switchLabels[1].classList.add('active');
                } else {
                    // Mostrar vista Puntuaciones SOLAMENTE
                    puntuacionesView.style.display = 'block';
                    superchatsView.style.display = 'none';
                    
                    // Actualizar labels
                    switchLabels[0].classList.add('active');
                    switchLabels[1].classList.remove('active');
                }
            }
            
            viewToggle.addEventListener('change', () => {
                updateViews(viewToggle.checked);
            });
            
            // Manejar cambios de tamaño de ventana
            window.addEventListener('resize', () => {
                if (viewToggle.checked) {
                    // Si estamos en vista SuperChats, actualizar el display
                    if (isMobile()) {
                        superchatsView.style.display = 'flex';
                    } else {
                        superchatsView.style.display = 'grid';
                    }
                }
            });
            
            // Inicializar estado - SOLO puntuaciones visible
            switchLabels[0].classList.add('active');
            puntuacionesView.style.display = 'block';
            superchatsView.style.display = 'none';
        }
        
        // Controles de SuperChats (eliminados - solo auto scroll automático)
        function initSuperChatControls() {
            // Auto scroll siempre activado automáticamente
            autoScroll = true;
        }
        
        // Función para limpiar SuperChats
        function clearSuperChats() {
            const superChatsList = document.getElementById('superchats-list');
            superChatsList.innerHTML = `
                <div class="no-superchats">
                    <div class="no-superchats-text">Chat Limpiado</div>
                    <div class="no-superchats-subtext">Los nuevos SuperChats aparecerán aquí</div>
                </div>
            `;
            
            // Resetear estadísticas
            totalSuperChats = 0;
            totalAmount = 0;
            updateSuperChatStats();
        }
        
        // Función para hacer scroll al final
        function scrollToBottom() {
            const superChatsList = document.getElementById('superchats-list');
            superChatsList.scrollTop = superChatsList.scrollHeight;
        }
        
        // Función para actualizar estadísticas (eliminada)
        function updateSuperChatStats() {
            // Estadísticas eliminadas - función vacía
        }
        
        // Función para obtener tier de color según monto USD
        function getTierClass(montoUSD) {
            if (montoUSD >= 100) return 'tier-6';      // $100+ - Púrpura
            if (montoUSD >= 50) return 'tier-5';       // $50-99 - Rojo
            if (montoUSD >= 20) return 'tier-4';       // $20-49 - Naranja
            if (montoUSD >= 10) return 'tier-3';       // $10-19 - Verde
            if (montoUSD >= 5) return 'tier-2';        // $5-9 - Cyan
            return 'tier-1';                           // $1-4 - Azul
        }

        // Mapeo de nombres de concursantes a imágenes
        const contestantImages = {
            'GIGI': 'images/gigi.jpg',
            'GIUSEPPE': 'images/GIUSEPPE.jpg',
            'VLADY': 'images/vlady.jpg',
            'CRAZY': 'images/CRAZY.jpg',
            'PAMELA': 'images/pamela.jpg',
            'KAROLA': 'images/karola.jpg',
            'JIMENEZ': 'images/JIMENEZ.jpg',
            'PEKY': 'images/peki.jpg',
            'CRUSITA': 'images/CRUSITA.jpg',
            'LUISE': 'images/luise.jpg'
        };

        // Función para generar HTML de imágenes de concursantes
        function generateContestantImages(concursantes) {
            if (concursantes.includes("SIN CLASIFICAR")) {
                // Para "SIN CLASIFICAR", mostrar todas las imágenes en miniatura
                const allImages = Object.keys(contestantImages).map(name => {
                    return `<img src="${contestantImages[name]}" alt="${name}" class="contestant-mini-img" title="${name}">`;
                }).join('');
                return `<div class="contestants-images multiple">${allImages}</div>`;
            } else {
                // Para concursantes específicos
                const images = concursantes.map(name => {
                    const imageSrc = contestantImages[name];
                    if (imageSrc) {
                        return `<img src="${imageSrc}" alt="${name}" class="contestant-mini-img" title="${name}">`;
                    }
                    return '';
                }).filter(img => img).join('');
                
                const multipleClass = concursantes.length > 1 ? 'multiple' : '';
                return `<div class="contestants-images ${multipleClass}">${images}</div>`;
            }
        }

        // Función para formatear texto de concursantes con imágenes
        function formatContestantsText(concursantes, puntosDistribuidos, distribucion) {
            const images = generateContestantImages(concursantes);
            
            let text = '';
            if (concursantes.includes("SIN CLASIFICAR")) {
                // Verificar si no se asignaron puntos por monto muy bajo
                if (distribucion && distribucion.includes("mínimo $10 requerido")) {
                    text = `Todos los participantes (0 pts - monto insuficiente)`;
                } else {
                    text = `Todos los participantes (${puntosDistribuidos} pts c/u)`;
                }
            } else {
                const participantes = concursantes.join(', ');
                const puntosCadaUno = concursantes.length > 1 ? ` (${puntosDistribuidos} pts c/u)` : ` (${puntosDistribuidos} pts)`;
                text = `${participantes}${puntosCadaUno}`;
            }
            
            return `${images}<span class="contestants-text">${text}</span>`;
        }

        // Función para agregar SuperChat
        function addSuperChat(superChatData) {
            const superChatsList = document.getElementById('superchats-list');
            
            // Remover mensaje de "no superchats" si existe
            const noSuperChats = superChatsList.querySelector('.no-superchats');
            if (noSuperChats) {
                noSuperChats.remove();
            }
            
            // Crear elemento de SuperChat
            const superChatElement = document.createElement('div');
            superChatElement.className = 'superchat-item';
            
            const timeString = new Date(superChatData.timestamp).toLocaleTimeString('es-DO', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            // Obtener tier de color
            const tierClass = getTierClass(superChatData.montoUSD);
            
            // Formatear texto de concursantes
            const contestantsText = formatContestantsText(superChatData.concursantes, superChatData.puntosDistribuidos, superChatData.distribucion);
            const contestantsClass = superChatData.concursantes.includes("SIN CLASIFICAR") ? 'sin-clasificar' : '';
            
            // Mostrar conversión de moneda si es diferente
            const conversionText = (superChatData.montoOriginal && superChatData.moneda && superChatData.moneda !== 'USD') ?
                `<div class="superchat-conversion">${superChatData.montoOriginal} ${superChatData.moneda} → $${superChatData.montoUSD} USD</div>` : '';
            
            superChatElement.innerHTML = `
                <div class="superchat-header">
                    <div class="superchat-author">${superChatData.autor}</div>
                    <div class="superchat-amount ${tierClass}">
                        $${superChatData.montoUSD}
                        ${conversionText}
                    </div>
                </div>
                <div class="superchat-message">${superChatData.mensaje || 'Sin mensaje'}</div>
                <div class="superchat-footer">
                    <div class="superchat-contestants ${contestantsClass}">${contestantsText}</div>
                    <div class="superchat-time">${timeString}</div>
                </div>
            `;
            
            // Agregar al inicio de la lista (más recientes arriba)
            superChatsList.insertBefore(superChatElement, superChatsList.firstChild);
            
            // Actualizar estadísticas (aunque no se muestren, mantener la lógica)
            totalSuperChats++;
            totalAmount += superChatData.montoUSD;
            updateSuperChatStats();
            
            // Auto scroll si está activado
            if (autoScroll) {
                setTimeout(scrollToBottom, 100);
            }
            
            // Animar entrada
            superChatElement.style.animation = 'slideInRight 0.5s ease-out';
        }
        
        // Función para solicitar puntuaciones via WebSocket
        function requestScores() {
            if (isConnected) {
                socket.emit('get-puntuaciones');
                console.log('📡 Solicitando puntuaciones via WebSocket');
            } else {
                console.log('❌ WebSocket no conectado, no se pueden obtener puntuaciones');
            }
        }

        // Links de Instagram de los concursantes
        const instagramLinks = {
            gigi: 'https://www.instagram.com/lagigird/',
            giuseppe: 'https://www.instagram.com/gbenignini/', // Ejemplo - ajustar con el real
            vlady: 'hhttps://www.instagram.com/justvladyg/', // Ejemplo - ajustar con el real
            crazy: 'https://www.instagram.com/crazydesignrd/', // Ejemplo - ajustar con el real
            pamela: 'https://www.instagram.com/shuupamela6.9/', // Ejemplo - ajustar con el real
            karola: 'https://www.instagram.com/karolalcendra_/', // Ejemplo - ajustar con el real
            jimenez: 'https://www.instagram.com/jimenez_tv/', // Ejemplo - ajustar con el real
            peky: 'https://www.instagram.com/lapekipr/', // Ejemplo - ajustar con el real
            crusita: 'https://www.instagram.com/crusita___/', // Ejemplo - ajustar con el real
            luise: 'https://www.instagram.com/luisemartinezz12/' // Ejemplo - ajustar con el real
        };

        // Función para abrir Instagram del concursante
        function openContestantProfile(contestantId) {
            const instagramUrl = instagramLinks[contestantId];
            if (instagramUrl) {
                window.open(instagramUrl, '_blank');
            } else {
                alert('Instagram del concursante no disponible aún');
            }
        }

        // Función para detectar cambios de posición y aplicar animaciones
        function detectPositionChanges(concursantes) {
            const currentPositions = {};
            const positionChanges = [];
            
            // Crear mapa de posiciones actuales
            concursantes.forEach((concursante, index) => {
                currentPositions[concursante.slug] = index + 1;
            });
            
            // Comparar con posiciones anteriores
            Object.keys(currentPositions).forEach(slug => {
                const currentPos = currentPositions[slug];
                const previousPos = previousPositions[slug];
                
                if (previousPos && previousPos !== currentPos) {
                    positionChanges.push({
                        slug: slug,
                        from: previousPos,
                        to: currentPos,
                        direction: currentPos < previousPos ? 'up' : 'down'
                    });
                }
            });
            
            // Actualizar posiciones anteriores
            previousPositions = { ...currentPositions };
            
            return positionChanges;
        }

        // Función para aplicar animaciones de cambio de posición
        function applyPositionAnimations(positionChanges) {
            positionChanges.forEach(change => {
                // Animar en vista principal (grid)
                const mainCard = document.querySelector(`#score-${change.slug}`)?.closest('.contestant-card');
                // Animar en vista de lista
                const listItem = document.querySelector(`[data-contestant="${change.slug}"]`);
                
                const elements = [mainCard, listItem].filter(el => el);
                
                elements.forEach(element => {
                    // Remover animaciones anteriores
                    element.classList.remove('moving-up', 'moving-down', 'position-changed', 'new-leader');
                    
                    // Aplicar nueva animación según el tipo de cambio
                    if (change.direction === 'up') {
                        element.classList.add('moving-up');
                        
                        // Efecto especial si llega al primer lugar
                        if (change.to === 1) {
                            setTimeout(() => {
                                element.classList.remove('moving-up');
                                element.classList.add('new-leader');
                            }, 1500);
                        }
                    } else {
                        element.classList.add('moving-down');
                    }
                    
                    // Remover clase después de la animación
                    setTimeout(() => {
                        element.classList.remove('moving-up', 'moving-down', 'position-changed');
                    }, change.direction === 'up' && change.to === 1 ? 3500 : 1500);
                });
                
                console.log(`🎯 ${change.slug} se movió del puesto ${change.from} al ${change.to} (${change.direction})`);
            });
        }

        // Función para reordenar concursantes según puntuación con animaciones
        function reorderContestants(concursantes) {
            const container = document.querySelector('.contestants-grid');
            const cards = Array.from(container.children);
            
            // Detectar cambios de posición ANTES del reordenamiento
            const positionChanges = detectPositionChanges(concursantes);
            
            // Crear un mapa de las cards actuales por slug
            const cardMap = {};
            cards.forEach(card => {
                const scoreElement = card.querySelector('.contestant-score');
                const id = scoreElement.id;
                if (id && id.startsWith('score-')) {
                    const slug = id.replace('score-', '');
                    cardMap[slug] = card;
                }
            });
            
            // Aplicar clase de reordenamiento
            container.classList.add('reordering');
            
            // Reordenar según la nueva data
            container.innerHTML = '';
            concursantes.forEach(concursante => {
                const card = cardMap[concursante.slug];
                if (card) {
                    container.appendChild(card);
                } else {
                    console.warn(`No se encontró card para: ${concursante.slug}`);
                }
            });
            
            // Remover clase de reordenamiento y aplicar animaciones
            setTimeout(() => {
                container.classList.remove('reordering');
                
                // Aplicar animaciones de cambio de posición
                if (positionChanges.length > 0) {
                    applyPositionAnimations(positionChanges);
                }
            }, 100);
        }

        // Función para actualizar tabla de posiciones en lista con animaciones
        function updatePositionsList(concursantes) {
            const positionsList = document.querySelector('.positions-list');
            if (!positionsList) return;

            const positionItems = Array.from(positionsList.children);
            
            // Crear un mapa de los items por contestant
            const itemMap = {};
            positionItems.forEach(item => {
                const contestant = item.getAttribute('data-contestant');
                if (contestant) {
                    itemMap[contestant] = item;
                }
            });
            
            // Aplicar clase de reordenamiento
            positionsList.classList.add('reordering');
            
            // Reordenar y actualizar
            positionsList.innerHTML = '';
            concursantes.forEach((concursante, index) => {
                const item = itemMap[concursante.slug];
                if (item) {
                    // Actualizar ranking
                    const rankElement = item.querySelector('.position-rank');
                    if (rankElement) {
                        rankElement.textContent = index + 1;
                    }
                    
                    // Actualizar puntos
                    const scoreElement = item.querySelector('.position-score');
                    if (scoreElement) {
                        scoreElement.textContent = `${Math.round(concursante.puntos_reales)} PTS`;
                    }
                    
                    // Agregar índice para animación
                    item.style.setProperty('--item-index', index);
                    
                    positionsList.appendChild(item);
                } else {
                    console.warn(`No se encontró position item para: ${concursante.slug}`);
                }
            });
            
            // Remover clase de reordenamiento
            setTimeout(() => {
                positionsList.classList.remove('reordering');
            }, 100);
        }

        // Función para actualizar la hora de última actualización
        function updateLastUpdateTime() {
            const now = new Date();
            const options = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true,
                timeZone: 'America/Santo_Domingo'
            };
            
            const timeString = now.toLocaleTimeString('es-DO', options);
            const dateString = now.toLocaleDateString('es-DO', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                timeZone: 'America/Santo_Domingo'
            });
            
            document.getElementById('last-update').textContent = `${dateString} - ${timeString}`;
        }

        // WebSocket Event Listeners
        socket.on('connect', () => {
            isConnected = true;
            console.log('🔌 Conectado al servidor WebSocket');
            // Solicitar puntuaciones iniciales al conectar
            requestScores();
        });
        
        socket.on('disconnect', () => {
            isConnected = false;
            console.log('🔌 Desconectado del servidor WebSocket');
        });
        
        socket.on('puntuaciones-update', (data) => {
            console.log('📊 Puntuaciones actualizadas via WebSocket');
            if (data.success) {
                // Actualizar tabla principal (vista puntuaciones)
                reorderContestants(data.data);
                data.data.forEach((concursante) => {
                    const scoreElement = document.getElementById(`score-${concursante.slug}`);
                    if (scoreElement) {
                        scoreElement.textContent = `${Math.round(concursante.puntos_reales)}PTS`;
                    }
                });
                
                // Actualizar tabla de posiciones en lista (vista combinada)
                updatePositionsList(data.data);
                
                // Actualizar la hora de última actualización cuando se reciben nuevas puntuaciones
                updateLastUpdateTime();
            }
        });
        
        socket.on('estadisticas-update', (stats) => {
            console.log('📈 Estadísticas actualizadas via WebSocket');
            // actualizarEstadisticasPanel(stats); // This function is not defined in the original file
        });
        
        socket.on('dia-actualizado', (info) => {
            console.log('📅 Día del reality actualizado:', info);
            // actualizarDiaEnHeader(info.diaActual, info.titulo); // This function is not defined in the original file
        });
        
        socket.on('monitor-status', (status) => {
            // if (status.diaActual) { // This function is not defined in the original file
            //     actualizarDiaEnHeader(status.diaActual, status.tituloVideo);
            // }
        });
        
        // Función para actualizar estadísticas del panel
        function actualizarEstadisticasPanel(stats) {
        }
        
        // Función para actualizar el día en el header
        function actualizarDiaEnHeader(dia, titulo) {
            const dayNumberElement = document.querySelector('.day-number');
            const dayTextElement = document.querySelector('.day-text');
            
            if (dayNumberElement) {
                // Animación de cambio
                dayNumberElement.style.transform = 'scale(1.2)';
                dayNumberElement.style.color = '#FFD700';
                
                setTimeout(() => {
                    dayNumberElement.textContent = dia;
                    setTimeout(() => {
                        dayNumberElement.style.transform = 'scale(1)';
                        dayNumberElement.style.color = '#ffffff';
                    }, 200);
                }, 100);
            }
            
            // Opcional: actualizar el título en la consola para debug
            if (titulo) {
            }
            
            // Notificación eliminada - solo actualiza silenciosamente
        }
        
        // Función para animar concursantes que recibieron puntos
        function animarConcursantesQueRecibieronPuntos(concursantesNombres) {
            concursantesNombres.forEach(nombreConcursante => {
                // Buscar la card por el nombre del concursante en ambas vistas
                const cards = document.querySelectorAll('.contestant-card, .position-item');
                cards.forEach(card => {
                    const nombreElement = card.querySelector('.contestant-name, .position-name');
                    if (nombreElement && nombreElement.textContent.trim() === nombreConcursante) {
                        // Animar la card
                        card.classList.add('points-received');
                        
                        // Remover la animación después de que termine
                        setTimeout(() => {
                            card.classList.remove('points-received');
                        }, 1000);
                    }
                });
            });
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            updateLastUpdateTime(); // Actualizar hora inmediatamente
            
            // Actualizar hora cada 5 minutos (solo la hora, los datos vienen por WebSocket)
            setInterval(() => {
                updateLastUpdateTime();
            }, 300000);

            // Inicializar controles de switch y SuperChats
            initViewSwitch();
            initSuperChatControls();

            // Escuchar mensajes de SuperChats en tiempo real
            socket.on('nuevo-superchat', (superChatData) => {
                addSuperChat(superChatData);
                // Animar concursantes que recibieron puntos si el mensaje incluye a alguien
                if (superChatData.concursantes && superChatData.concursantes.length > 0) {
                    animarConcursantesQueRecibieronPuntos(superChatData.concursantes);
                }
            });
        });
    </script>
</body>
</html> 